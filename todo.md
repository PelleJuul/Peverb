Add a marking algorithm to the `prepare()` function, to prevent infinete loops.
